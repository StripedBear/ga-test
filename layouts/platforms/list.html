{{ define "title" }}{{ .Title }}{{ end }}
{{ define "main" }}

{{ $currentPlatform := .Title | urlize }}
{{ $projects := .Pages.ByWeight.Reverse }}

<div class="container mb-5 mb-md-6">
  <div class="o-inner-container o-inner-container--small mx-auto">
    <div class="text-center text-white">
      <h1 class="u-fs-huge mb-0">{{ .Title }}</h1>
    </div>
  </div>
</div>

<!-- identical dropdown (same HTML as in projects section) -->
<div class="c-dd-nav" id="projects-category-dropdown">
  <span class="c-dd-nav__current js-dd-nav-open" id="projects-category-toggle">
    <span class="projects-categories-selected">All categories</span>
  </span>
  <ul class="c-dd-nav__list js-dd-nav-list" id="projects-categories-menu" >
    <li class="projects-categories-item">
      <a href="/projects/" class="blog-categories-link">All categories</a>
    </li>
    {{ range .Site.Taxonomies.platforms }}
    <li class="projects-categories-item {{ if eq (.Page.Title | urlize) $currentPlatform }}active{{ end }}">
      <a href="{{ .Page.Permalink }}"
         class="blog-categories-link {{ if eq (.Page.Title | urlize) $currentPlatform }}active{{ end }}">
        {{ .Page.Title }}
      </a>
    </li>
    {{ end }}
  </ul>
</div>

<!-- FULL projects grid EXACTLY as in /projects/ -->
<div class="projects-grid" id="projects-grid" style="margin-top: 0px">
  {{ range $projects }}
  <article class="project-card"
           data-platforms="{{ range .Params.platforms }}{{ . | urlize }} {{ end }}">
    <a href="{{ .RelPermalink }}" class="project-card-link">

      {{ $featuredImage := false }}
      {{ if .Params.featured_image }}
        {{ $featuredImage = .Resources.Get .Params.featured_image }}
        {{ if not $featuredImage }}
          {{ $featuredImage = .Resources.GetMatch (printf "*%s*" .Params.featured_image) }}
        {{ end }}
      {{ else }}
        {{ $featuredImage = .Resources.GetMatch "featured.*" }}
        {{ if not $featuredImage }}
          {{ $featuredImage = .Resources.GetMatch "thumbnail.*" }}
        {{ end }}
      {{ end }}

      <div class="project-card__background" {{ if $featuredImage }}
           style="background-image:url('{{ $featuredImage.RelPermalink }}');"{{ end }}>
      </div>

      <div class="project-card__overlay"></div>

      <div class="project-card__description">
        {{ if .Params.platforms }}
        <span class="project-card__platforms">
          {{ $platforms := .Params.platforms }}
          {{ range $i, $p := $platforms }}{{ $p }}{{ if lt $i (sub (len $platforms) 1) }}, {{ end }}{{ end }}
        </span>
        {{ end }}

        <h3 class="project-card__title">{{ .Title }}</h3>
      </div>

      <div class="project-card__more">
        <div class="project-card__button">Read more</div>
      </div>

    </a>
  </article>
  {{ end }}
</div>

{{ if gt (len $projects) 9 }}
<div class="container">
  <div class="projects-load-more">
    <button class="projects-load-more-btn" id="projects-load-more-btn" type="button">
      Load more projects
    </button>
  </div>
</div>
{{ end }}

{{ end }}
