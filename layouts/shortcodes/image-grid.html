{{ $outerClass := default "image-grid" (.Get "class") }}
{{ $gridClass := default "grid" (.Get "gridClass") }}
{{ $itemClass := default "grid-item" (.Get "itemClass") }}

<div class="{{ $outerClass }}">
  <div class="{{ $gridClass }}">
    {{ $images := split .Inner "\n" }}
    {{ range $images }}
      {{ $line := trim . " \t\r" }}
      {{ if and $line (ne $line "") }}
        {{ $parts := split $line "|" }}
        {{ $img := trim (index $parts 0) " " }}
        {{ $alt := default "" (index $parts 1) }}
        {{ if eq $alt "" }}
          {{ $alt = path.Base $img | replaceRE "\\.[^.]+$" "" | replaceRE "[-_]" " " | humanize }}
        {{ end }}
        {{ if $img }}
          {{ $imgResource := false }}
          {{ $imgURL := "" }}
          
          {{/* Try to find resource in Page Bundle */}}
          {{ if $.Page.Resources }}
            {{ $imgResource = $.Page.Resources.Get $img }}
            {{ if not $imgResource }}
              {{ $imgResource = $.Page.Resources.GetMatch (printf "*%s*" $img) }}
            {{ end }}
          {{ end }}
          
          {{ if $imgResource }}
            {{/* Use resource from Page Bundle */}}
            {{ $imgURL = $imgResource.RelPermalink }}
          {{ else }}
            {{/* Fallback: absolute path for common resources */}}
            {{ $imgPath := $img | strings.TrimPrefix "/" }}
            {{ if not (hasPrefix $imgPath "img/") }}
              {{ $imgPath = printf "img/%s" $imgPath }}
            {{ end }}
            {{ $imgURL = $imgPath | relURL }}
          {{ end }}
        <div class="{{ $itemClass }}">
          <img src="{{ $imgURL }}" alt="{{ trim $alt " " }}">
        </div>
        {{ end }}
      {{ end }}
    {{ end }}
  </div>
</div>
