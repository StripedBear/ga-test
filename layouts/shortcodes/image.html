{{ $imgSrc := (.Get "src") | default (.Get 0) }}
{{ $imgResource := false }}
{{ $imgURL := "" }}

{{/* Try to find resource in Page Bundle */}}
{{ if .Page.Resources }}
  {{ $imgResource = .Page.Resources.Get $imgSrc }}
  {{ if not $imgResource }}
    {{ $imgResource = .Page.Resources.GetMatch (printf "*%s*" $imgSrc) }}
  {{ end }}
{{ end }}

{{ if $imgResource }}
  {{/* Use resource from Page Bundle */}}
  {{ $imgURL = $imgResource.RelPermalink }}
{{ else }}
  {{/* Fallback: absolute path for common resources (logo, footer, etc.) */}}
  {{ $imgPath := $imgSrc | strings.TrimPrefix "/" }}
  {{ if not (hasPrefix $imgPath "img/") }}
    {{ $imgPath = printf "img/%s" $imgPath }}
  {{ end }}
  {{ $imgURL = $imgPath | relURL }}
{{ end }}

<div class="{{ default "image" (.Get "class") }}">
  <img src="{{ $imgURL }}" alt="{{ default (path.Base $imgSrc | replaceRE "\\.[^.]+$" "" | replaceRE "[-_]" " " | humanize) (.Get "alt") }}">
</div>
