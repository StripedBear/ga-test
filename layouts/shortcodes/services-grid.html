{{ $gridClass := default "services-grid" (.Get "gridClass") }}
{{ $itemClass := default "service-item" (.Get "itemClass") }}

{{ if eq $gridClass "services-grid-homepage" }}
<style>
  .services-grid-homepage {
    display: grid !important;
    grid-template-columns: repeat(5, 1fr) !important;
    gap: 40px 20px !important;
  }

  /* Mobile: match original sizes */
  @media (max-width: 767px) {
    .services-grid-homepage {
      grid-template-columns: repeat(2, 1fr) !important;
      gap: 30px 20px !important;
    }

    /* Services heading: 30px on mobile */
    .c-services-home .u-fs-huge {
      font-size: 30px !important;
    }

    /* Service icons: 110x110 on mobile */
    .services-grid-homepage .service-item__icon {
      width: 110px !important;
      height: 110px !important;
      margin-bottom: 22px !important;
    }

    .services-grid-homepage .service-item__icon img {
      width: 110px !important;
      height: 110px !important;
    }

    /* Service title: 14px on mobile */
    .services-grid-homepage .service-item h3 {
      font-size: 14px !important;
    }
  }

  @media (max-width: 575px) {
    .services-grid-homepage {
      grid-template-columns: repeat(2, 1fr) !important;
      gap: 20px 12px !important;
    }
  }
</style>
{{ end }}

<div class="{{ $gridClass }}">
  {{ $services := split .Inner "\n" }}
  {{ range $services }}
    {{ $line := trim . " \t\r" }}
    {{ if and $line (ne $line "") }}
      {{ $parts := split $line "|" }}
      {{ $icon := trim (index $parts 0) " " }}
      {{ $title := trim (index $parts 1) " " }}
      {{ if and $icon $title }}
        {{ $imgResource := false }}
        {{ $imgURL := "" }}
        
        {{/* Try to find resource in Page Bundle */}}
        {{ if $.Page.Resources }}
          {{ $imgResource = $.Page.Resources.Get $icon }}
          {{ if not $imgResource }}
            {{ $imgResource = $.Page.Resources.GetMatch (printf "*%s*" $icon) }}
          {{ end }}
        {{ end }}
        
        {{/* If not found, check parent section resources */}}
        {{ if not $imgResource }}
          {{ $section := $.Page.Section }}
          {{ if $section }}
            {{ $sectionPage := $.Page.Site.GetPage "section" $section }}
            {{ if $sectionPage }}
              {{ if $sectionPage.Resources }}
                {{ $imgResource = $sectionPage.Resources.Get $icon }}
                {{ if not $imgResource }}
                  {{ $imgResource = $sectionPage.Resources.GetMatch (printf "*%s*" $icon) }}
                {{ end }}
              {{ end }}
            {{ end }}
          {{ end }}
        {{ end }}
        
        {{ if $imgResource }}
          {{/* Use resource from Page Bundle or section */}}
          {{ $imgURL = $imgResource.RelPermalink }}
        {{ else }}
          {{/* Fallback: absolute path for common resources */}}
          {{ $imgPath := $icon | strings.TrimPrefix "/" }}
          {{ if not (hasPrefix $imgPath "img/") }}
            {{ $imgPath = printf "img/%s" $icon }}
          {{ end }}
          {{ $imgURL = $imgPath | relURL }}
        {{ end }}
        
        <div class="{{ $itemClass }}">
          <div class="service-item__icon mb-5">
            <img src="{{ $imgURL }}" alt="{{ $title }}">
          </div>
          <h3>{{ $title | safeHTML }}</h3>
        </div>
      {{ end }}
    {{ end }}
  {{ end }}
</div>

